<div class="promo_page">
    <h2 id="promomainheading" class="store_list_padding">Centre Events</h2>
    <div class="searchdiv store_list_padding">
        <label for="event_select">SEARCH EVENTS</label>
        <span class="selector-wrap" id="event_select">
            <span class="select_event">Narrow Your Search</span>
            <label for="narrow_your_search" style="display:none">narrow your search</label>
            <select id="narrow_your_search">
                <option value="">Narrow Your Search</option>                
                <option value="all">View All Chronologically</option>
                <option value="event">Centre Events</option>
                <option value="property_promo">Kids Club Events</option>
                <option value="store_promo">Sales and Promotions</option>
            </select>
            <span class="select_icon"></span>
        </span>
    </div>
    <br/>
    <div class="event_list all_events_promo" id="event_promo_container">
        <script id="event_promo_template" type="x-tmpl-mustache/text">
            <h3>
                <div class="event_time">
                    <span class="weekday {{day}}">  </span>
                    <span class="event_month">{{month}}</span>
                    <span class="event_date">{{date}}</span>                
                </div>
                    {{store_name}} - {{name}}
                <span class="event_period">
                    {{dates}}
                </span>
            </h3>
            
            <div class="event_detail" id="promo{{id}}">                     
                <div class="event_info info_toggle">
                    <img alt="promo image" src="{{image_url}}" class="promoeventimage" />                
                    <div class="event_summary">
                        <h4>Event Summary:</h4>
                           {{{rich_description}}}
                    </div>
                </div>
                <div class="details">
                    <div class="action">
                        <a href="javascript:toggle_detail('promo{{id}}');" class="toggle">Read more</a>
                        <a href="http://www.facebook.com/sharer.php?u={{main_host}}/{{type}}/{{slug}}" target="_blank" class="share_btn facebook">
                            <span style="display:none">facebook</span>
                        </a>
                        <a href="http://twitter.com/?status=Check%20out%20what%27s%20going%20on%20at%20St.%20Vital%20Centre%21%20{{main_host}}/{{type}}/{{slug}}" target="_blank" class="share_btn twitter">
                            <span style="display:none">twitter</span>
                        </a>
                        <a title="Email this event" href="mailto:?subject={{name}}&body=Check%20out%20what%27s%20going%20on%20at%20St.%20Vital%20Centre%21%20{{main_host}}/{{type}}/{{slug}}" class="share_btn email">
                            <span style="display:none">share</span>
                        </a>
                        <a href="/save_promotions/{{slug}}"  class="share_btn ical"><span style="display:none">calender</span></a>
                        <a href="/{{type}}/{{slug}}" class="share_btn link"><span style="display:none">show</span></a>
                    </div>
                </div>
            </div>
      </script> 
    </div>
    
    <br/>
    <hr />
    <h1 class="page_title future_promo">Future Promotions</h1>
        <div id="future_promo_container">
            <script id="future_promo_template" type="x-tmpl-mustache/text">    
                <div class="store_promo">
                    <div id="img{{slug}}" class="lightbox hide fade"  tabindex="-1" role="dialog" aria-hidden="true">
                        <div class='lightbox-content'>
                            <img ALT="promo_image" src="{{image_url}}"/>   
                        </div>
                    </div>
                    <a data-toggle="lightbox" href="#img{{slug}}">                
                        <img ALT="promo_image" src="{{image_url}}"/>                
                        
                    </a>
                    <div class="promo_info">
                        <h2>
                            <a href="/stores/{slug}}">
                            {{store_name}} - {{name}}                        
                            </a>
                        </h2>
                        <span class="promo_date">
                            {{dates}} 
                        </span>
                        
                        <p>{{description}}</p>
                    </div>
                </div>
            <div class="line_break">&nbsp;</div>
        </script>
    </div>
    
</div>
<script>
    $(document).ready(function(e){
        init(e);
        loadMallData(renderAll);
    });

    function toggle_detail(promo_div){
        $("#"+promo_div+" .info_toggle").toggle();
    }
    
    function renderAll(){
        $('.flexslider').flexslider({
            animation: "slide",
            controlNav: false,
            directionNav: false,        
            prevText: "Previous",
            nextText: "Next"
        });
       
       var n = 0;
	console.log("loading init(e)",n);
    $(".home_page h3").each(function(){
        console.log("loads colour");
        if (n % 4 == 1 ){
            $(this).addClass("yellow");    
            $(this).addClass("ph"+n);    
        } 
        if (n % 4 == 2 ){
            $(this).removeClass("yellow");  
            $(this).addClass("purple");  
            $(this).addClass("ph"+n);    
        }
        if (n % 4 == 3 ){
            $(this).removeClass("yellow");  
            $(this).removeClass("purple");  
            $(this).addClass("red");    
            $(this).addClass("ph"+n);    
        } 
        
        n = n+1;
    });    
       
        $(".all_events_promo, .mall_events, .store_event, .property_event").hide();
        $(".selector-wrap select").hover(
            function(){
                $(this).next().css("background-color","#F3047A")
            },
            function(){
                $(this).next().css("background-color","#05E7E4")
            }
        );
        $("a.toggle").click(function(){
            if ($(this).text().indexOf("more") != -1){
                $(this).text("Read less"); 
            } else {
                $(this).text("Read more");    
            }            
        });
        $("#event_select select").change(function(){
            if ($(this).val() == "event"){
                window.location = "/events"
            } else if ($(this).val() == "store_promo"){
                $(".all_events_promo").hide();
                $(".property_event").hide();
                $(".mall_events").hide();
                $(".store_event").show();             
                $("#promomainheading").text("Sales and Promotions");
            } else if ($(this).val() == "property_promo"){
                $(".all_events_promo").hide();
                $(".store_event").hide();
                $(".mall_events").hide();
                $(".property_event").show();                
                $("#promomainheading").text("Kids Club Events");
            } else if ($(this).val() == "all"){
                window.location = "/promotions"
            }
            
            var cat_name = $(this).find("option:selected").text();            
            $("#category_select .select_name").text(cat_name);
        })
        
        if (getURLParameter("show") == "kids-club"){
            $(".all_events_promo").remove();
            $(".store_event").remove();
            $(".mall_events").remove();
            $(".property_event").show();
        } else if (getURLParameter("show") == "sales"){
            $(".all_events_promo").remove();
            $(".mall_events").remove();
            $(".store_event").show();
            $(".property_event").show();
        } else{
            $(".store_event").remove();
            $(".property_event").remove();
            $(".mall_events").remove();
            $(".all_events_promo").show();
        }
        
        

        var promotions = getPromotionsList();
        var store_promos = promotions.concat(getEventsList()).sortBy(function(o){ return o.start_date });
        var published_promos = [];
        $.each( store_promos , function( key, val ){
            // today = new Date();
            // webDate = new Date(val.show_on_web_date)
            
            today = moment();
            webDate = moment(val.show_on_web_date);
            if (today >= webDate) {
                published_promos.push(val)
            } 
        });
        if (published_promos.length > 0){
            renderPromotions("#event_promo_container","#event_promo_template", published_promos);
        }
        var future_promos = [];
        $.each( store_promos , function( key, val ){
            // today = new Date();
            // webDate = new Date(val.show_on_web_date)
            
            today = moment();
            webDate = moment(val.show_on_web_date);
            if (today < webDate) {
                future_promos.push(val)
            } 
        });
        if (future_promos.length > 0){
            renderPromotions("#future_promo_container","#future_promo_template", future_promos);
        }
        else {
            $(".future_promo").hide();
        }
        show_content();
   
    }
</script>