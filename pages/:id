<div >
    <h2 class="page_title" id="page_title"></h2>
    <div id="page_body_content">
        
    </div>
    <div id="kid_club_extra">
    <h3>Kids Club Registration</h3>
    <p>Please remember to pick up your Kids Club Card and Membership Package within 30 days of registration.</p>
    
    
    <div class="store_list_padding kids_club">
        
        <div class="row-fluid">
            <div class="span6">
              <label for="loyalty_first_name">Child's First Name *</label>
              <input id="loyalty_first_name" name="loyalty[first_name]" size="30" type="text">
              <span class="required" id="loyalty_first_name_required">This field cannot be left blank</span>
            </div>
            <div class="span6">
              <label for="loyalty_last_name">Child's Last Name *</label>
              <input id="loyalty_last_name" name="loyalty[last_name]" size="30" type="text">
              <span class="required" id="loyalty_last_name_required">This field cannot be left blank</span>
            </div>
        </div>
        
        
        <div class="row-fluid">
            <div class="span6">
                <label for="loyalty_address">Street Address *</label>
                <input id="loyalty_address" name="loyalty[address]" size="30" type="text">    
                <span class="required" id="loyalty_address_required">This field cannot be left blank</span>
            </div>
            <div class="span6">
                <label for="loyalty_postal_code">Postal code *</label>
                <input id="loyalty_postal_code" name="loyalty[postal_code]" size="30" type="text">
                <span class="required" id="loyalty_postal_code_required">This field cannot be left blank</span>
            </div>
        </div>        
        
        <div class="row-fluid">
            <div class="span6">
              <label for="loyalty_phone">Phone number *</label>
              <input id="loyalty_phone" name="loyalty[phone]" size="30" type="text">
              <span class="required" id="loyalty_phone_required">This field cannot be left blank</span>
            </div>            
            
            <div class="span6">
                <label for="loyalty_birthday">Child's Birthday</label>
                
                <span class="selector-wrap" id="month_select">
                    <span class="select_name">Jan</span>
                    <select id="loyalty_birthday_month" name="loyalty[birthday(2i)]">
                        <option value="1">Jan</option>
                        <option value="2">Feb</option>
                        <option value="3">Mar</option>
                        <option value="4">Apr</option>
                        <option value="5">May</option>
                        <option value="6">Jun</option>
                        <option value="7">Jul</option>
                        <option value="8">Aug</option>
                        <option value="9">Sept</option>
                        <option value="10">Oct</option>
                        <option value="11">Nov</option>
                        <option value="12">Dec</option>
                    </select>
                    <span class="select_icon"></span>
                </span>
                
                <span class="selector-wrap" id="day_select">
                    <span class="select_name">1</span>
                    <select id="loyalty_birthday_day" name="loyalty[birthday(3i)]">
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                        <option value="11">11</option>
                        <option value="12">12</option>
                        <option value="13">13</option>
                        <option value="14">14</option>
                        <option value="15">15</option>
                        <option value="16">16</option>
                        <option value="17">17</option>
                        <option value="18">18</option>
                        <option value="19">19</option>
                        <option value="20">20</option>
                        <option value="21">21</option>
                        <option value="22">22</option>
                        <option value="23">23</option>
                        <option value="24">24</option>
                        <option value="25">25</option>
                        <option value="26">26</option>
                        <option value="27">27</option>
                        <option value="28">28</option>
                        <option value="29">29</option>
                        <option value="30">30</option>
                        <option value="31">31</option>
                    </select> 
                    <span class="select_icon"></span>
                </span>

                <span class="selector-wrap" id="year_select">
                    <span class="select_name">2000</span>
                    <select id="loyalty_birthday_year" name="loyalty[birthday(1i)]">
                        <option value="2000">2000</option>
                        <option value="2001">2001</option>
                        <option value="2002">2002</option>
                        <option value="2003">2003</option>
                        <option value="2004">2004</option>
                        <option value="2005">2005</option>
                        <option value="2006">2006</option>
                        <option value="2007">2007</option>
                        <option value="2008">2008</option>
                        <option value="2009">2009</option>
                        <option value="2010">2010</option>
                        <option value="2011">2011</option>
                        <option value="2012">2012</option>
                        <option value="2013">2013</option>
                        <option value="2014">2014</option>
                        <option value="2015">2015</option>
                        <option value="2016">2016</option>
                        <option value="2017">2017</option>
                        <option value="2018">2018</option>
                        <option value="2019">2019</option>
                        <option value="2020">2020</option>
                    </select>
                    <span class="select_icon"></span>
                </span>
                
            </div>            
        </div>
        
        <div class="row-fluid">
            <div class="span6">
                <label for="loyalty_parent_name">Parent's' name *</label>
                <input id="loyalty_parent_name" name="loyalty[parent_name]" size="30" type="text">
                <span class="required" id="loyalty_parent_name_required">This field cannot be left blank</span>
            </div>
            <div class="span6">
              <label for="loyalty_email">Parent's' Email *</label>
              <input id="loyalty_email" name="loyalty[email]" size="30" type="text">
              <span class="required" id="loyalty_email_required">This field cannot be left blank</span>
            </div>            
        </div>
        
        <div class="field">
            <label for="loyalty_How_did_you_hear_about_the_St_Vital_Centre_Kids_Centre">How did you hear about the st vital centre kids centre?</label>
            <span class="selector-wrap" id="heard_select">
                <span class="select_name">Select one</span>
                <select id="loyalty_note" name="loyalty[note]">
                    <option value="">Select one</option>
                    <option value="In St Vital Centre">In St Vital Centre</option>
                    <option value="St Vital Centre website">St Vital Centre website</option>
                    <option value="From a friend">From a friend</option>
                    <option value="At a Kids Club event">At a Kids Club event</option>
                    <option value="Other">Other</option>                
                </select>
                <span class="select_icon"></span>
            </span>
        </div>
        
        <div class="field">        
            <input id="loyalty_newsletter" name="loyalty[newsletter]" type="checkbox">
            <span class="newsletter_text">I would like to receive communications from St. Vital Centre on specials and events for the Kids Club. I have read and understood the Privacy Policy.*</span>
        </div>
        <div class="actions">
            <a class="signup_kids_club" href="javascript:signup_kids_club();">SEND</a>
        </div>        
    </div>  
    
    <h3>Kids Club Discounts</h3>
    
    <p>Kids Club discounts are offered to all St. Vital Centre Kids Club members every Tuesday. Please show your membership card to receive these special Kids Club discounts.</p>
    <p>Offers are subject to change without notice.</p>
    
    <ul class="info-list wide">
        {% assign repos = site.property.repos %}
        
	    {% for repo in repos %}
	        {% if repo.slug == "svc-kids-club-discounts" %}
	            {% for item in repo.site_images%}
    	            <li>
        			    <strong><a href="{{item.url}}">{{item.name}}</a></strong>
        			    <span>{{item.description}}</span>
        		    </li>
                {% endfor %}
        	{% endif %}
	    {% endfor %}
	</ul>
    <form id="kids_agency_form" action="http://app.emediatemail.com/t/r/s/jtoujj/" method="post" style="display:none">
        <input id="fieldName_kids_agency" name="cm-name" type="text" align="top"/>
        <input id="fieldEmail_kids_agency" name="cm-jtoujj-jtoujj" type="email"/>
    </form>
    </div>
</div>

<script>
$(window).load(function() {
        $('.flexslider').flexslider({
            animation: "slide",
            controlNav: false,
            directionNav: false,        
            prevText: "Previous",
            nextText: "Next"
        });
    });
    $(document).ready(function(e) {
        init(e);
        loadMallDataCached(renderAll); 
      
       
    });
    function renderAll(){
        var pathArray = window.location.pathname.split( '/' );
        var slug = pathArray[pathArray.length-1];
        prefix = get_prefix();
        var pages_json = prefix+"/pages/" + slug + ".json"
        $.getJSON(pages_json).done(function(data) {
            //var pages_data = JSON.parse(data);
            // console.log(data.body);
            
            $("#page_title").html(data.title)
            $('#page_body_content').html(data.body);
            var n = 0;
    	
            $("div#page_body_content h3").each(function(){
                console.log("hi");
                if (n % 4 == 1 ){
                    $(this).addClass("yellow");    
                    $(this).addClass("ph"+n);    
                } 
                if (n % 4 == 2 ){
                    $(this).removeClass("yellow");  
                    $(this).addClass("purple");  
                    $(this).addClass("ph"+n);    
                }
                if (n % 4 == 3 ){
                    $(this).removeClass("yellow");  
                    $(this).removeClass("purple");  
                    $(this).addClass("red");    
                    $(this).addClass("ph"+n);    
                } 
                
                n = n+1;
            });
        }).fail(function(jqXHR) {
            if (jqXHR.status == 404) {
                $("#404_msg").fadeIn("fast");
            }
        });
        if(slug.indexOf("kids-club") > -1) {
            $("#kid_club_extra").show();
            $("div#kid_club_extra h3").each(function(){
                // console.log("hi");
                if (n % 4 == 1 ){
                    $(this).addClass("yellow");    
                    $(this).addClass("ph"+n);    
                } 
                if (n % 4 == 2 ){
                    $(this).removeClass("yellow");  
                    $(this).addClass("purple");  
                    $(this).addClass("ph"+n);    
                }
                if (n % 4 == 3 ){
                    $(this).removeClass("yellow");  
                    $(this).removeClass("purple");  
                    $(this).addClass("red");    
                    $(this).addClass("ph"+n);    
                } 
                
                n = n+1;
            });
        }
        else {
              $("#kid_club_extra").hide();
        }
        show_content();
        
    }
      
        $(function(){
            
            
            $(".selector-wrap select").change(function(){                
                var cat_name = $(this).find("option:selected").text();            
                $(this).parent().find("span").first().text(cat_name);
            })
        })
        
        function signup_kids_club(){
            $(".required").hide();
            var valid = true;
            if ($("#loyalty_first_name").val() == ""){
                $("#loyalty_first_name_required").show();  
                valid = false;
            }
            if ($("#loyalty_last_name").val() == ""){
                $("#loyalty_last_name_required").show();  
                valid = false;
            }
            if ($("#loyalty_address").val() == ""){
                $("#loyalty_address_required").show();  
                valid = false;
            }
            if ($("#loyalty_postal_code").val() == ""){
                $("#loyalty_postal_code_required").show();  
                valid = false;
            }
            if ($("#loyalty_phone").val() == ""){
                $("#loyalty_phone_required").show(); 
                valid = false;
            }
            if ($("#loyalty_parent_name").val() == ""){
                $("#loyalty_parent_name_required").show(); 
                valid = false;
            }
            if ($("#loyalty_email").val() == ""){
                $("#loyalty_email_required").text("This field cannot be left blank");
                $("#loyalty_email_required").show(); 
                valid = false;
            } else if (!isValidEmailAddress($("#loyalty_email").val())) { 
                valid = false;
                $("#loyalty_email_required").text("This must be a valid email address.");
                $("#loyalty_email_required").show();
            }           
            
            if (valid){
                var data = {}
                var loyalty = {}
        //         loyalty["property_id"] = {{site.property.id}}
        //         loyalty["first_name"] = $("#loyalty_first_name").val();
        //         loyalty["last_name"] = $("#loyalty_last_name").val();
        //         loyalty["address"] = $("#loyalty_address").val();
        //         loyalty["postal_code"] = $("#loyalty_postal_code").val();
        //         loyalty["phone"] = $("#loyalty_phone").val();
        //         loyalty["birthday"] = $("#loyalty_birthday_year").val() +"-"+ $("#loyalty_birthday_month").val() +"-"+ $("#loyalty_birthday_day").val();
        //         loyalty["parent_name"] = $("#loyalty_parent_name").val();
        //         loyalty["email"] = $("#loyalty_email").val();
        //         loyalty["note"] = $("#loyalty_note").val();
                
        //         var newsletter;
        //         if ($("#loyalty_newsletter").prop('checked') == true){
        //             newsletter = true;
        //         } else {
        //             newsletter = false;
        //         }
                
        //         loyalty["newsletter"] = newsletter;                
        //         data["loyalty"] = loyalty;
        //         data["custom_email"] = "true";
        //         data["custom_email_to"] = "stvguestservices@20vic.com";                
        //         data["custom_email_subject"] = "New Kids Club Signup"
        //         var email_body = {}
        //         email_body["Childs_Name"] = $("#loyalty_first_name").val() + " " + $("#loyalty_last_name").val();
        //         email_body["Address_And_Postal_Code"] = $("#loyalty_address").val() + " - " + $("#loyalty_postal_code").val();
        //         email_body["Phone_Number"] = $("#loyalty_phone").val();
        //         email_body["Birthday"] = $("#loyalty_birthday_year").val() +"-"+ $("#loyalty_birthday_month").val() +"-"+ $("#loyalty_birthday_day").val();
        //         email_body["Parents_Name"] = $("#loyalty_parent_name").val();
        //         email_body["Parents_Email"] = $("#loyalty_email").val();
        //         data["custom_email_body"] = email_body;
                
        //         $.ajax({
        //             url: "/add_loyalty",
        //             type: "POST",
        //             data: data,
        //         	success: function(response){     
        //                 if (newsletter){
        //                     signup_kids_club_agency();
        //         	    }
        //                 else{
        //                     window.location.href = "/pages/svc-thanks"
        //                 }
        // 			},
        //             error: function(xhr, ajaxOptions, thrownError){
        //                 alert("Please try again later.");
        // 			}
        //         })
            }
            
        }
        function signup_kids_club_agency(){
            $('#fieldName_kids_agency').val($("#loyalty_parent_name").val());
            $('#fieldEmail_kids_agency').val($("#loyalty_email").val());
            $('form#kids_agency_form').submit();
        }
        $('form#kids_agency_form').submit(function (e) {
            e.preventDefault();
            $.getJSON(
                this.action + "?callback=?",
                $(this).serialize(),
                function (data) {
                    if (data.Status === 400) {
                        alert("Please try again later.");
                    } else { // 200
                	    window.location.href = "/pages/svc-thanks"
                    }
            });
        });
    
</script>