<div class="store_detail">
    <script id="store_detail_template" type="x-tmpl-mustache">
        <div class="map_area">
        
        <div class="store_img">
            {% if store.store_front_url contains "missing.png" %}
            {% else%}
            <img src="{{store.store_front_url}}" />
            {% endif %}
            <div id="mapsvg"></div>             
            <span id="compass">&nbsp;</span>
            <a id="mapshot-toggle" href="javascript:toggle_map();"></a>
        </div>
        
        <div class="store_list_padding">
            <h2 class="store_profile">Store profile</h2>            
        </div>
                
        <h3 class="store_title">{{name}}</h3>
        
        <div class="store_list_padding store_detail_info">
            <h4>contact information</h4>
            <p>
                <strong style="{{show}}">Website: </strong> <a href="{{store.website}}">{{store.website}}</a> <br/>
                <strong style="{{phone_show}}">Phone: </strong> {{phone}}<br/>
               <strong>Address: </strong> <br/>
                {% if store.unit %}
                Unit {{store.unit}}<br/>
                {% endif %}
                {{store.property.address1}}<br/>
                {{store.property.city}}, {{store.property.province_state}}<br/>
                {{store.property.postal_code}}<br/>
            </p>
            
            <p>
                {{description}}
            </p>
            {% if store.tags and store.tags != blank %}
            <h4>brands</h4>
            <p>
               -{{tags}}-
            </p>
            {% endif %}
            
            {% if store.payment_methods and store.payment_methods != ""  %}
            <h4>accepted methods of payment</h4>
            {% assign payments = store.payment_methods | split: "," %}
            <ul class="payment">
            {% for payment in payments %}
                <li>- {{payment}}</li>
            {% endfor %}
            </ul>
            {% endif %}
            
            {% if store.return_policy %}
            <h4>return/exchange policy</h4>
            <p>{{store.return_policy}}</p>
            {% endif %} 
            
            {% assign promosize = store.current_promotions | size %}
            {% if promosize  > 0 %}    
                <h3>Sales & Promotions</h3>
                <ul class="stoore_links store_list_padding">
                    {% for promo in store.current_promotions %}
                    <li>- <a href="/promotions/{{promo.slug}}">{{promo.name}}</a></li>
                    {% endfor %}
                </ul>
            {% endif %}
            {% assign job_size = store.current_jobs | size %}
            {% if job_size  > 0 %}    
                <h3>Job Postings</h3>
                <ul class="stoore_links store_list_padding">
                    {% for job in store.current_jobs %}
                    <li>- <a href="/jobs/{{job.slug}}">{{job.name}}</a></li>
                    {% endfor %}
                </ul>
            {% endif %}
            <p class="back store_list_padding">
                <a href="/stores"><img src="{{1846 | get_image_url}}">Back to Directory</a>
            </p>
        </div>   
                
                    
        <div class="store_list_padding unit_info">
            {{store.description_2}}
            <h2 class="hidden"></h2>
            
            <p class="download_design_spec">
                {% if store.neighbourhood %}
                    {% assign neighbourhood =  store.neighbourhood | downcase %}
                    {% assign repo = "svc-building-design-specs" | get_repo_by_slug %}
                    {% for file in repo.site_images %}
                        {% assign filename = file.name | downcase %}
                        {% if neighbourhood  == filename %}
                            <a href="{{file.image_url}}" target="_blank">You can click here to download these design specs as an Adobe PDF file.</a>                                                 
                        {% endif %}
                    {% endfor %}                    
                {% else %}
                    <i>Sorry, no design requirements are available for this unit.</i>
                {% endif %}
            </p>
            <p class="back">
                <a href="/stores?building=1&enu=0"><img src="{{1846 | get_image_url}}">List tenants...</a>
            </p>
        </div>
    </div>
    </script>
</div>






<script>
    $(document).ready(function(e){
        init(e); 
        $(".flexslider").remove();
        loadMallData(renderAll); 
    });
    
    var svgH;
    var svgW;
    if ($(window).width() <= 479){
        svgH = 186;
        svgW = 295;
    } else if ($(window).width() <= 767){
        svgH = 300;
        svgW = 366;
    } else{
        svgH = 375;
        svgW = 970;
    }
    

    $('#mapsvg').mapSvg({
        source: '{{site.property.svgmap_file_path}}',    // Path to SVG map
        colors: {stroke: '#aaaaaa', selected: "#F3047A", hover: 0},
        width: svgW,
        height:svgH,
        popover: 'auto',
        disableAll: true,
        viewBox: [520,150,1350,1400],
        regions: {
            {% if store.svgmap_region %}
            {{ store.svgmap_region }}:{
				tooltip: false,				
                selected: true,
                popover : "<label class='store_name_map store_name_map_detail'>{{ store.name }}</label>"
			},        	
            {% endif %}
        },
        tooltipsMode:   'custom',
        zoom: false,
        pan:false,
        cursor:'pointer',
        responsive:true,
        zoomLimit: [-1,5]
    });
    
    $(function(){
//        $("#main_li_item_2").hide();
        $(".flexslider").remove();  
        $(".unit_info ul li").each(function(){
            $(this).prepend("- ")
        })
        
        
        if (getURLParameter("building") == "1"){
            $(".unit_info").show();            

            $(".map_area h2.store_profile").html("{{store.name}} <span>UNIT {{store.unit}} ({{store.name_2}} FT<sup>2</sup>)</span>");
            {% if store.neighbourhood %}
            $(".map_area h3.store_title").html("Design Requirements - {{store.neighbourhood | escape}} <a class='expend_all' href='javascript:expend_all();'>expand all</a>");
            {% else %}
            $(".map_area h3.store_title").html("Design Requirements")
            {% endif %}
            
            $(".unit_info h2").each(function(){
                var title = $(this).text();
                $(this).html("<strong>"+title+"</strong> <span>read more</span>");                                
                $("<p class='readless'>read less</p>").insertBefore( $(this) );
            })
            $(".readless").first().remove();
            $(".unit_info h2").click(function(){
                $(this).nextUntil( "h2" ).show();
            })
            
            $(".readless").on("click",function(){
                $(this).hide();
                $(this).prevUntil( "h2" ).hide();
            })
            
            $(".unit_info ul, .unit_info p").hide(); 
            $(".unit_info ul li ul").show();
            $(".download_design_spec, .back").show();            
        } else{
            $(".store_detail_info").show();
        }
        
        
     })
     
     var map_hide = true;
     function toggle_map(){                
        $(".store_img img").toggle();
        if (map_hide){            
            $(".store_img a").addClass("mapview");            
            map_hide = false;
        } else{
            $("#mapshot-toggle").removeClass("mapview");            
            map_hide = true;
        }
     }
     
     function expend_all(){
         $(".unit_info ul, .unit_info p").show();
     }
     
    
    function renderAll(){
        
        var pathArray = window.location.pathname.split( '/' );
        var slug =getStoreDetailsBySlug(slug);
        var store = getStoreBySlug();
        renderStoreDetails("#store_detail", "#store_detail_template",store);
        
        show_content();
    }
</script>