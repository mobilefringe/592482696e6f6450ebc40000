<div class="store_detail">
    <script id="store_detail_template" type="x-tmpl-mustache">
        <div class="map_area">
        
        <div class="store_img">
            
            <img src="{{store_front_url}}" alt={{alt_store_front_url}}" />
            
            <div id="mapsvg"></div>             
            <span id="compass">&nbsp;</span>
            <a id="mapshot-toggle" href="javascript:toggle_map();"></a>
        </div>
        
        <div class="store_list_padding">
            <h2 class="store_profile">Store profile</h2>            
        </div>
                
        <h3 class="store_title">{{name}}</h3>
        
        <div class="store_list_padding store_detail_info">
            <h4>contact information</h4>
            <p>
                <strong style="{{show}}">Website: </strong> <a href="{{store.website}}">{{store.website}}</a> <br/>
                <strong style="{{phone_show}}">Phone: </strong> {{phone}}<br/>
                <strong>Address: </strong> <br/>
                
                Unit {{unit}}<br/>
                
                {{property.address1}}<br/>
                {{property.city}}, {{property.province_state}}<br/>
                {{property.postal_code}}<br/>
            </p>
            
            <p>
                {{description}}
            </p>
            
            <h4 style="{{tagsâ€“show}}>brands</h4>
            <p>
               -{{tags}}-
            </p>
            
            
            <h4 >accepted methods of payment</h4>
            
            <ul class="payment">
            
                <li>- {{payment}}</li>
           
            </ul>
            
            
            <h4 style="return_show">return/exchange policy</h4>
            <p>{{return_policy}}</p>
           
            <h3 id="promotions_header">Sales & Promotions</h3>
            <div id="promos_container">
                <script id="promos_template" type="x-tmple-mustache/text">
                    <ul class="stoore_links store_list_padding">
                    
                    <li>- <a href="/promotions/{{slug}}">{{name}}</a></li>
                  
                    </ul>
                </script>
            </div>
            
            {% assign job_size = store.current_jobs | size %}
            {% if job_size  > 0 %}    
                <h3>Job Postings</h3>
                <ul class="stoore_links store_list_padding">
                    {% for job in store.current_jobs %}
                    <li>- <a href="/jobs/{{job.slug}}">{{job.name}}</a></li>
                    {% endfor %}
                </ul>
            {% endif %}
            <p class="back store_list_padding">
                <a href="/stores"><img src="{{1846 | get_image_url}}">Back to Directory</a>
            </p>
        </div>   
                
                    
        <div class="store_list_padding unit_info">
            {{store.description_2}}
            <h2 class="hidden"></h2>
            
            <p class="download_design_spec">
                {% if store.neighbourhood %}
                    {% assign neighbourhood =  store.neighbourhood | downcase %}
                    {% assign repo = "svc-building-design-specs" | get_repo_by_slug %}
                    {% for file in repo.site_images %}
                        {% assign filename = file.name | downcase %}
                        {% if neighbourhood  == filename %}
                            <a href="{{file.image_url}}" target="_blank">You can click here to download these design specs as an Adobe PDF file.</a>                                                 
                        {% endif %}
                    {% endfor %}                    
                {% else %}
                    <i>Sorry, no design requirements are available for this unit.</i>
                {% endif %}
            </p>
            <p class="back">
                <a href="/stores?building=1&enu=0"><img src="{{1846 | get_image_url}}">List tenants...</a>
            </p>
        </div>
    </div>
    </script>
</div>


<script type="text/javascript" src="//codecloud.cdn.speedyrails.net/sites/592482696e6f6450ebc40000/text/javascript/1495734604000/jquery.js"></script>
<script type="text/javascript" src="//codecloud.cdn.speedyrails.net/sites/592482696e6f6450ebc40000/text/javascript/1495734613000/raphael.js"></script>
<script type="text/javascript" src="//codecloud.cdn.speedyrails.net/sites/592482696e6f6450ebc40000/text/javascript/1495734619000/jquery.mousewheel.js"></script>
<script type="text/javascript" src="//codecloud.cdn.speedyrails.net/sites/592482696e6f6450ebc40000/text/javascript/1495734624000/mapsvg.js"></script>



<script>
    $(document).ready(function(e){
        init(e); 
        $(".flexslider").remove();
        loadMallData(renderAll); 
    });
    function renderAll(){
        var pathArray = window.location.pathname.split( '/' );
        var slug = pathArray[pathArray.length-1];
        var store =getStoreDetailsBySlug(slug);
        renderStoreDetails("#store_detail", "#store_detail_template",store,slug);
        
        var store_promo_ids = store_details.promotions
        var store_promos = getPromotionsForIds(store_promo_ids).sortBy(function(o){ return o.start_date });
        var published_promos = [];
        $.each( store_promos , function( key, val ){
            // today = new Date();
            // webDate = new Date(val.show_on_web_date)
            
            today = moment();
            webDate = moment(val.show_on_web_date);
            if (today >= webDate) {
                published_promos.push(val)
            } 
        });
        if (published_promos.length > 0){
            renderPromotions("#promos_container","#promos_template", published_promos);
        }
        else {
            $('#promotions_header').hide();
        }
        
        
        var svgH;
        var svgW;
        if ($(window).width() <= 479){
            svgH = 186;
            svgW = 295;
        } else if ($(window).width() <= 767){
            svgH = 300;
            svgW = 366;
        } else{
            svgH = 375;
            svgW = 970;
        }
        console.log(svgH,svgW);
        reg = {}
        if(store.svgmap_region != null && typeof(store.svgmap_region)  != 'undefined'){
            obj = {};
            obj["tooltip"] = "<label class='store_name_map'> "+store.name +"</label>"
            obj["attr"] = {}
            obj["attr"]["href"] = '/stores/'+store.slug 
            reg[store.svgmap_region] = obj
        }
       
        $('#mapsvg').mapSvg({
            source: '//codecloud.cdn.speedyrails.net/sites/592482696e6f6450ebc40000/image/svg+xml/1495736476000/StVital_Map_2016-09-30.svg',    // Path to SVG map
            colors: {stroke: '#aaaaaa', selected: "#F3047A", hover: 0},
            width: svgW,
            height:svgH,
            popover: 'auto',
            disableAll: true,
            viewBox: [520,150,1350,1400],
            regions: reg,
            tooltipsMode:   'custom',
            zoom: false,
            pan:false,
            cursor:'pointer',
            responsive:true,
            zoomLimit: [-1,5]
        });


        $(".unit_info ul li").each(function(){
            $(this).prepend("- ")
        })
        
        
        if (getURLParameter("building") == "1"){
            $(".unit_info").show();            

            $(".map_area h2.store_profile").html("{{store.name}} <span>UNIT {{store.unit}} ({{store.name_2}} FT<sup>2</sup>)</span>");
            if (store.neighbourhood ) {
                $(".map_area h3.store_title").html("Design Requirements - {{store.neighbourhood | escape}} <a class='expend_all' href='javascript:expend_all();'>expand all</a>");}
            else {
                $(".map_area h3.store_title").html("Design Requirements")
            }
            
            $(".unit_info h2").each(function(){
                var title = $(this).text();
                $(this).html("<strong>"+title+"</strong> <span>read more</span>");                                
                $("<p class='readless'>read less</p>").insertBefore( $(this) );
            })
            $(".readless").first().remove();
            $(".unit_info h2").click(function(){
                $(this).nextUntil( "h2" ).show();
            })
            
            $(".readless").on("click",function(){
                $(this).hide();
                $(this).prevUntil( "h2" ).hide();
            })
            
            $(".unit_info ul, .unit_info p").hide(); 
            $(".unit_info ul li ul").show();
            $(".download_design_spec, .back").show();            
        } else{
            $(".store_detail_info").show();
        }

         
         var map_hide = true;
         function toggle_map(){                
            $(".store_img img").toggle();
            if (map_hide){            
                $(".store_img a").addClass("mapview");            
                map_hide = false;
            } else{
                $("#mapshot-toggle").removeClass("mapview");            
                map_hide = true;
            }
         }
         
         function expend_all(){
             $(".unit_info ul, .unit_info p").show();
         }

        show_content();
    }
</script>